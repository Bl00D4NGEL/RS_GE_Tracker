<head>
<script src="./js/jquery.js"></script>
<title>Runescape Grand Exchange Tracker</title>
</head>
<body>
<div style="width:50%; float:left">
<table id="main-table">
<tr>
	<th>ID</th>
	<th>Amount</th>
	<th>Item Name</th>
	<th>Bought/Sold</th>
	<th>Date</th>
</tr>
</table>
</div>
<div style="width: 50%; float:left">
	<form id="newItem">
		<table>
			<tr>
				<td>Amount of Items purchased</td>
				<td><input type="text" name="itemAmount"></td>
			</tr>
			<tr>
				<td><span>Name of the Item purchased</span></td>
				<td><input type="text" name="itemName"></td>
			</tr>
			<tr>
				<td>Bought or Sold?</td>
				<td style="display:flex; justify-content: space-around">
					<div>
						<label>
							<input type="radio" name="bors" value="Bought">Bought
						</label>

					</div>
					<div>
						<label>
							<input type="radio" name="bors" value="Sold">Sold
						</label>
					</div>
				</td>
			</tr>
			<tr>
				<td></td>
				<td><input style="width: 100%" type="submit" value="Confirm"></td>
			</tr>
		</table>
	</form>
</div>

<script type="text/javascript">

$(document).ready(function(){
	console.log("Starting to generate table..");
	<!-- Table generation -->
	var data = JSON.parse(localStorage.getItem("geData"));
	data = {
		"item": {
			"ID": "1",
			"Amount": "123",
			"Name": "Dragon Bones",
			"BORS": "Bought",
			"Date": "01.12.2017"
		},
	};

	console.log(data);
	for(var entry in data){
		entry = data[entry];
		console.log(entry);
		var tr = $(document.createElement("tr")).appendTo("#main-table");
		var td = $(document.createElement("td"));
		td.clone().html(entry.ID).appendTo(tr);
		td.clone().html(entry.Amount).appendTo(tr);
		td.clone().html(entry.Name).appendTo(tr);
		td.clone().html(entry.BORS).appendTo(tr);
		td.clone().html(entry.Date).appendTo(tr);
	}

	$("table").css({'border': "1px solid black", "padding": "10px"});
	$("table").find("td").css({'border': "1px solid black", "padding": "10px"});
	$("table").find("th").css({'border': "2px solid grey", "padding": "10px"});
});

$("#newItem").on("submit", function(e){
	e.preventDefault();
	alert("Submitted");
	var form = $("#newItem");
	var amount = form.find("input[name=itemAmount]").val();
	var name = form.find("input[name=itemName]").val();
	var bors = form.find("input[name=bors]:checked").val();
	console.log(form);
	console.log(amount);
	console.log(name);
	if(	
		amount == "" || 
		amount == undefined || 
		name == "" || 
		name == undefined ||
		bors == "" ||
		bors == undefined
	){
		return;
	}
	amount = amount.replace(/k/i, "000");
	amount = amount.replace(/m/i, "000000");
	amount = amount.replace(/\D+/, "");
	amount = parseInt(amount);
	if(typeof(amount) != "number"){
		console.log("Something went wrong when trying to convert amount into a number!");
		console.log("Type: ", typeof amount);
		console.log("VALUE: " + amount);
	}
	var data = JSON.parse(localStorage.getItem("data"));

	var d = new Date();
	var mon = d.getMonth() + 1;
	if(mon < 10){mon = "0" + mon;}
	var day = d.getDate();
	if(day < 10){day = "0" + day;}
	var dateString = d.getFullYear() + "-" + mon + "-" + day;
	var newObj = {};
	newObj["Amount"] = amount;
	newObj["Name"] = name;
	newObj["Date"] = dateString;
	newObj["BORS"] = bors;

console.log(newObj);
console.log(JSON.stringify(newObj));
	localStorage.setItem("data", JSON.stringify(data));

});
</script>


</body>
